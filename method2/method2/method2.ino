typedef unsigned char u8;

unsigned char text1table[256]={0 , 30, 60, 90, 120, 150, 180, 210, 240, 14, 44, 74, 104, 134, 164, 194, 225, 255, 29, 59, 89, 119, 149, 179, 209, 239, 13, 43, 73, 103, 133, 163, 195, 225, 255, 29, 59, 89, 119, 149, 179, 209, 239, 13, 43, 73, 103, 133, 164, 194, 224, 254, 28, 58, 88, 118, 148, 178, 208, 238, 12, 42, 72, 102, 135, 165, 195, 225, 255, 29, 59, 89, 119, 149, 179, 209, 239, 13, 43, 73, 104, 134, 164, 194, 224, 254, 28, 58, 88, 118, 148, 178, 208, 238, 12, 42, 74, 104, 134, 164, 194, 224, 254, 28, 58, 88, 118, 148, 178, 208, 238, 12, 43, 73, 103, 133, 163, 193, 223, 253, 27, 57, 87, 117, 147, 177, 207, 237, 15, 45, 75, 105, 135, 165, 195, 225, 255, 29, 59, 89, 119, 149, 179, 209, 240, 14, 44, 74, 104, 134, 164, 194, 224, 254, 28, 58, 88, 118, 148, 178, 210, 240, 14, 44, 74, 104, 134, 164, 194, 224, 254, 28, 58, 88, 118, 148, 179, 209, 239, 13, 43, 73, 103, 133, 163, 193, 223, 253, 27, 57, 87, 117, 150, 180, 210, 240, 14, 44, 74, 104, 134, 164, 194, 224, 254, 28, 58, 88, 119, 149, 179, 209, 239, 13, 43, 73, 103, 133, 163, 193, 223, 253, 27, 57, 89, 119, 149, 179, 209, 239, 13, 43, 73, 103, 133, 163, 193, 223, 253, 27, 58, 88, 118, 148, 178, 208, 238, 12, 42, 72, 102, 132, 162, 192, 222, 252};
unsigned char text2table[256]={0 , 240, 225, 17, 195, 51, 34, 210, 135, 119, 102, 150, 68, 180, 165, 85, 15, 255, 238, 30, 204, 60, 45, 221, 136, 120, 105, 153, 75, 187, 170, 90, 30, 238, 255, 15, 221, 45, 60, 204, 153, 105, 120, 136, 90, 170, 187, 75, 17, 225, 240, 0, 210, 34, 51, 195, 150, 102, 119, 135, 85, 165, 180, 68, 60, 204, 221, 45, 255, 15, 30, 238, 187, 75, 90, 170, 120, 136, 153, 105, 51, 195, 210, 34, 240, 0, 17, 225, 180, 68, 85, 165, 119, 135, 150, 102, 34, 210, 195, 51, 225, 17, 0, 240, 165, 85, 68, 180, 102, 150, 135, 119, 45, 221, 204, 60, 238, 30, 15, 255, 170, 90, 75, 187, 105, 153, 136, 120, 120, 136, 153, 105, 187, 75, 90, 170, 255, 15, 30, 238, 60, 204, 221, 45, 119, 135, 150, 102, 180, 68, 85, 165, 240, 0, 17, 225, 51, 195, 210, 34, 102, 150, 135, 119, 165, 85, 68, 180, 225, 17, 0, 240, 34, 210, 195, 51, 105, 153, 136, 120, 170, 90, 75, 187, 238, 30, 15, 255, 45, 221, 204, 60, 68, 180, 165, 85, 135, 119, 102, 150, 195, 51, 34, 210, 0, 240, 225, 17, 75, 187, 170, 90, 136, 120, 105, 153, 204, 60, 45, 221, 15, 255, 238, 30, 90, 170, 187, 75, 153, 105, 120, 136, 221, 45, 60, 204, 30, 238, 255, 15, 85, 165, 180, 68, 150, 102, 119, 135, 210, 34, 51, 195, 17, 225, 240, 0};
unsigned char key1table[256]={0 , 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224, 240, 1, 17, 33, 49, 65, 81, 97, 113, 129, 145, 161, 177, 193, 209, 225, 241, 2, 18, 34, 50, 66, 82, 98, 114, 130, 146, 162, 178, 194, 210, 226, 242, 3, 19, 35, 51, 67, 83, 99, 115, 131, 147, 163, 179, 195, 211, 227, 243, 4, 20, 36, 52, 68, 84, 100, 116, 132, 148, 164, 180, 196, 212, 228, 244, 5, 21, 37, 53, 69, 85, 101, 117, 133, 149, 165, 181, 197, 213, 229, 245, 6, 22, 38, 54, 70, 86, 102, 118, 134, 150, 166, 182, 198, 214, 230, 246, 7, 23, 39, 55, 71, 87, 103, 119, 135, 151, 167, 183, 199, 215, 231, 247, 8, 24, 40, 56, 72, 88, 104, 120, 136, 152, 168, 184, 200, 216, 232, 248, 9, 25, 41, 57, 73, 89, 105, 121, 137, 153, 169, 185, 201, 217, 233, 249, 10, 26, 42, 58, 74, 90, 106, 122, 138, 154, 170, 186, 202, 218, 234, 250, 11, 27, 43, 59, 75, 91, 107, 123, 139, 155, 171, 187, 203, 219, 235, 251, 12, 28, 44, 60, 76, 92, 108, 124, 140, 156, 172, 188, 204, 220, 236, 252, 13, 29, 45, 61, 77, 93, 109, 125, 141, 157, 173, 189, 205, 221, 237, 253, 14, 30, 46, 62, 78, 94, 110, 126, 142, 158, 174, 190, 206, 222, 238, 254, 15, 31, 47, 63, 79, 95, 111, 127, 143, 159, 175, 191, 207, 223, 239, 255};
  unsigned char key2table[256]={0 , 64, 128, 192, 1, 65, 129, 193, 2, 66, 130, 194, 3, 67, 131, 195, 4, 68, 132, 196, 5, 69, 133, 197, 6, 70, 134, 198, 7, 71, 135, 199, 8, 72, 136, 200, 9, 73, 137, 201, 10, 74, 138, 202, 11, 75, 139, 203, 12, 76, 140, 204, 13, 77, 141, 205, 14, 78, 142, 206, 15, 79, 143, 207, 16, 80, 144, 208, 17, 81, 145, 209, 18, 82, 146, 210, 19, 83, 147, 211, 20, 84, 148, 212, 21, 85, 149, 213, 22, 86, 150, 214, 23, 87, 151, 215, 24, 88, 152, 216, 25, 89, 153, 217, 26, 90, 154, 218, 27, 91, 155, 219, 28, 92, 156, 220, 29, 93, 157, 221, 30, 94, 158, 222, 31, 95, 159, 223, 32, 96, 160, 224, 33, 97, 161, 225, 34, 98, 162, 226, 35, 99, 163, 227, 36, 100, 164, 228, 37, 101, 165, 229, 38, 102, 166, 230, 39, 103, 167, 231, 40, 104, 168, 232, 41, 105, 169, 233, 42, 106, 170, 234, 43, 107, 171, 235, 44, 108, 172, 236, 45, 109, 173, 237, 46, 110, 174, 238, 47, 111, 175, 239, 48, 112, 176, 240, 49, 113, 177, 241, 50, 114, 178, 242, 51, 115, 179, 243, 52, 116, 180, 244, 53, 117, 181, 245, 54, 118, 182, 246, 55, 119, 183, 247, 56, 120, 184, 248, 57, 121, 185, 249, 58, 122, 186, 250, 59, 123, 187, 251, 60, 124, 188, 252, 61, 125, 189, 253, 62, 126, 190, 254, 63, 127, 191, 255};
void setup() {
  // put your setup code here, to run once:
  Serial.begin(9600);
  Serial.println();
  u32 time1;
  u32 time2;
  u8 key[2]={0x12,0x34};
  u8 text[2]={0x56,0x78};
  u8 rnd[20];

  int i=0;
  time1=millis();
  for(i=0;i<5000;i++){
  key_gen(rnd,key);
  enc(text,rnd);
  key_gen(rnd,text);
  enc(key,rnd);
  }
  time2=millis();
  Serial.println((time2-time1));

}

void loop() {
  // put your main code here, to run repeatedly:

}

void key_gen(u8* rnd, u8* key){
  
  u8 key1= key[0];
  u8 key2= key[1];
  u8 tmp1,tmp2;

  key1=key1table[key1];
  key2=key2table[key2];
  tmp1=key1 + key2;
  tmp2=key1 ^ key2;
  key1=tmp1;
  key2=tmp2;
  rnd[0]=key1;
  rnd[1]=key2;
  
  key1=key1table[key1];
  key2=key2table[key2];
  tmp1=key1 + key2;
  tmp2=key1 ^ key2;
  key1=tmp1;
  key2=tmp2;
  rnd[2]=key1;
  rnd[3]=key2;
  
  key1=key1table[key1];
  key2=key2table[key2];
  tmp1=key1 + key2;
  tmp2=key1 ^ key2;
  key1=tmp1;
  key2=tmp2;
  rnd[4]=key1;
  rnd[5]=key2;

  key1=key1table[key1];
  key2=key2table[key2];
  tmp1=key1 + key2;
  tmp2=key1 ^ key2;
  key1=tmp1;
  key2=tmp2;
  rnd[6]=key1;
  rnd[7]=key2;

  key1=key1table[key1];
  key2=key2table[key2];
  tmp1=key1 + key2;
  tmp2=key1 ^ key2;
  key1=tmp1;
  key2=tmp2;
  rnd[8]=key1;
  rnd[9]=key2;

  key1=key1table[key1];
  key2=key2table[key2];
  tmp1=key1 + key2;
  tmp2=key1 ^ key2;
  key1=tmp1;
  key2=tmp2;
  rnd[10]=key1;
  rnd[11]=key2;

  key1=key1table[key1];
  key2=key2table[key2];
  tmp1=key1 + key2;
  tmp2=key1 ^ key2;
  key1=tmp1;
  key2=tmp2;
  rnd[12]=key1;
  rnd[13]=key2;

  key1=key1table[key1];
  key2=key2table[key2];
  tmp1=key1 + key2;
  tmp2=key1 ^ key2;
  key1=tmp1;
  key2=tmp2;
  rnd[14]=key1;
  rnd[15]=key2;

  key1=key1table[key1];
  key2=key2table[key2];
  tmp1=key1 + key2;
  tmp2=key1 ^ key2;
  key1=tmp1;
  key2=tmp2;
  rnd[16]=key1;
  rnd[17]=key2;
  
  key1=key1table[key1];
  key2=key2table[key2];
  tmp1=key1 + key2;
  tmp2=key1 ^ key2;
  key1=tmp1;
  key2=tmp2;
  rnd[18]=key1;
  rnd[19]=key2;
}

void enc(u8* text, u8* rnd){
  u8 text1 = text[0];
  u8 text2 = text[1];

  text1 =text1table[text1]+rnd[0];
  text2 =text2table[text2]^rnd[1];
  text1 =text1table[text1]+rnd[2];
  text2 =text2table[text2]^rnd[3];
  text1 =text1table[text1]+rnd[4];
  text2 =text2table[text2]^rnd[5];
  text1 =text1table[text1]+rnd[6];
  text2 =text2table[text2]^rnd[7];
  text1 =text1table[text1]+rnd[8];
  text2 =text2table[text2]^rnd[9];
  text1 =text1table[text1]+rnd[10];
  text2 =text2table[text2]^rnd[11];
  text1 =text1table[text1]+rnd[12];
  text2 =text2table[text2]^rnd[13];
  text1 =text1table[text1]+rnd[14];
  text2 =text2table[text2]^rnd[15];
  text1 =text1table[text1]+rnd[16];
  text2 =text2table[text2]^rnd[17];
  text1 =text1table[text1]+rnd[18];
  text2 =text2table[text2]^rnd[19];
  text[0]=text1;
  text[1]=text2;
}
void test_vector(){
  u8 key[2]={0x12,0x34};
  u8 text[2]={0x56,0x78};
  u8 rnd[20];

  key_gen(rnd,key);
  enc(text,rnd);
  Serial.println(text[0],HEX);
  Serial.println(text[1],HEX);
}

